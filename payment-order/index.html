<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™×</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
.scale-container {
  transform: scale(0.82);
  transform-origin: top center;
  width: 122%;
}

:root{
  --primary:#005f73; --secondary:#0a9396; --bg:#f4f7f9; --panel:#fff;
  --text:#1f2937; --label:#4b5563; --border:#dbe3ea; --accent:#ee9b00;
  --danger:#ae2012; --blue:#0a58ff; --muted:#6b7280;
  --maxw:860px;
}

*{box-sizing:border-box}
body{
  font-family:'Heebo',sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
  padding:12px;
  display:flex;
  justify-content:center;
  min-height:100vh
}

.calculator{width:100%;max-width:var(--maxw)}
header{
  background:var(--primary);color:#fff;border-radius:14px;box-shadow:0 8px 22px rgba(0,0,0,.08);
  padding:10px 14px;display:flex;align-items:center;justify-content:center;position:relative
}
header h1{margin:0;font-size:1.28rem;line-height:1}
.year-badge{position:absolute;inset-inline-start:10px;inset-block-start:8px;font-size:.72rem;color:#e6f4f1;background:rgba(255,255,255,.12);padding:3px 8px;border:1px solid rgba(255,255,255,.25);border-radius:10px}

.board{
  margin-top:10px;background:#fbfeff;border:1px solid #e6eef5;border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,.06);
  padding:10px;
  display:grid;grid-template-columns:1fr 1fr;gap:10px;
}

/* ×”×—×œ×¤×ª ×¡×“×¨ ×”×¢××•×“×•×ª: ×”×ª×•×¦××•×ª ×‘×™××™×Ÿ, ×”×”×–× ×” ×‘×©×××œ */
.results-col{background:#eaf6f6;border:1px solid var(--border);border-radius:12px;padding:10px;grid-column:1}
.inputs-col{background:#fff;border:1px solid var(--border);border-radius:12px;padding:10px;grid-column:2}

.section-title{margin:2px 0 8px;color:var(--primary);font-size:.98rem;font-weight:700;text-align:center}
.controls-top{display:flex;gap:8px;justify-content:center;margin:6px 0 10px;flex-wrap:nowrap}
.btn{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #cfd8e3;border-radius:10px;background:#fff;cursor:pointer;font-weight:500;font-size:.9rem}
.btn:hover{background:#f6f8fb}
.btn.reset{border-color:#a0aec0}

.result-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.result-card{background:#fff;border:1px solid #dbe9ea;border-radius:10px;padding:8px;text-align:center}
.result-card .k{color:var(--muted);font-weight:500;font-size:.9rem}
.result-card .v{margin-top:4px;font-weight:700;color:var(--accent);font-size:1rem}

/* ×¢×™×¦×•×‘ ××“ ×”××—×•×–×™× ×”×•×™×–×•××œ×™ */
.ratio-visual {
  grid-column: 1/-1;
  background: #eee;
  height: 10px;
  border-radius: 5px;
  margin: 5px 0 10px;
  overflow: hidden;
  display: flex;
}
.ratio-bar-d { background: var(--secondary); transition: width 0.3s; width: 50%; }
.ratio-bar-p { background: var(--accent); transition: width 0.3s; width: 50%; }

.result-wide{grid-column:1/-1}
.result-big .v{font-size:1.08rem;color:var(--blue)}
.result-danger .v{color:var(--danger)}
.zero-case{color:#c2410c;font-weight:800;font-size:.98rem}

.center-card{max-width:340px;margin-inline:auto}
.solo-pay{grid-column:1/-1;max-width:340px;justify-self:center}

.row{display:grid;gap:8px}
.row-2{grid-template-columns:repeat(2,minmax(0,1fr))}
.row-3{grid-template-columns:repeat(3,minmax(0,1fr))}
.input-pair{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
.input-group{display:flex;flex-direction:column;align-items:stretch}
.input-group label{
  font-weight:600;color:var(--label);display:flex;gap:6px;align-items:center;justify-content:center;
  margin-bottom:3px;font-size:.9rem;text-align:center;min-height:40px;line-height:1.2
}
.input-group input,.input-group select,.input-group textarea{
  border:1px solid var(--border);padding:6px 8px;border-radius:10px;font-size:.95rem;background:#fbfeff
}
.input-group textarea{min-height:70px;resize:vertical}
.readonly{background:#f2f6ff;border-color:#cfe0ff;color:#1f3a8a;font-weight:600}

.status-row{max-width:60%;margin-inline:auto}

.toggles-line{display:flex;gap:8px;align-items:center;justify-content:center;flex-wrap:nowrap}
.chip{
  padding:5px 10px;border:1px solid #cfd8e3;border-radius:999px !important;
  background:#fff;cursor:pointer;font-size:.88rem;line-height:1;color:#0b2239;
}
.chip.active{background:#0d9488;color:#fff;border-color:#0d9488}

.info-btn{width:18px;height:18px;border-radius:50%;background:#eef6f6;color:#0d6b6b;display:inline-flex;align-items:center;justify-content:center;font-size:.8rem;border:1px solid #d4e7e7;cursor:pointer}
.pop{position:absolute;z-index:1000;max-width:320px;background:#fff7d6;color:#3b2f00;border:1px solid #ffe6a8;border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.15);padding:10px 12px;line-height:1.45}

.report-trigger{display:flex;justify-content:center;margin:8px 0 4px}
.report-btn{background:#fff;border:1px dashed #c8d2de;padding:8px 12px;border-radius:12px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;font-size:.95rem;font-weight:600}
#reportPanel{display:none}

.sticky-mobile{display:none}

@media (max-width:768px){
  .board{grid-template-columns:1fr;gap:10px}
  .inputs-col{order:1}
  .results-col{order:2;padding-bottom:84px}
  .sticky-mobile{
    position:fixed;left:50%;transform:translateX(-50%);
    width:min(100%, var(--maxw));
    bottom:0;background:#ffffffcc;backdrop-filter:saturate(1.2) blur(6px);
    border-top:1px solid #dfe7ee;padding:6px 8px;display:flex;gap:6px;justify-content:space-between;z-index:10
  }
}
.shot-scale{transform:scale(.96);transform-origin:top center}
</style>
</head>
<body>
<div class="scale-container">
  <div class="calculator" id="calcRoot">
    <header>
      <span class="year-badge" id="yearBadge"></span>
      <h1>××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™×</h1>
    </header>

    <div class="board">
      <div class="results-col">
        <div class="controls-top">
          <button class="btn" id="btnPdf">ğŸ–¨ï¸ PDF</button>
          <button class="btn" id="btnShot">ğŸ“¸ ×¦×™×œ×•×</button>
          <button class="btn" id="btnMail">âœ‰ï¸ ×©×œ×™×—×ª ××™×™×œ</button>
          <button class="btn reset" id="btnReset">â†º ××™×¤×•×¡</button>
        </div>

        <div class="section-title">×ª×•×¦××•×ª ×”×—×™×©×•×‘</div>

        <div class="result-grid">
          <div class="result-card"><div class="k">×¡×š ×”×›× ×¡×•×ª</div><div class="v" id="totalIncomeResult">â‚ª 0</div></div>
          <div class="result-card"><div class="k">×§×¦×‘×ª ×™×œ×“×™×</div><div class="v" id="socialSecurityAllowance">â‚ª 0</div></div>

          <div class="result-card"><div class="k">×“××™ ××—×™×™×” ×‘×›×‘×•×“</div><div class="v" id="baseLivingCostResult">â‚ª 0</div></div>
          <div class="result-card"><div class="k">×¡×š ×”×•×¦××•×ª</div><div class="v" id="totalExpensesResult">â‚ª 0</div></div>

          <div class="result-card result-wide result-big">
            <div class="k">×”×›× ×¡×” ×¤× ×•×™×” ×œ×ª× ×”××©×¤×—×ª×™</div>
            <div class="v" id="disposableIncomeResult">××™×Ÿ ×”×›× ×¡×” ×¤× ×•×™×”</div>
          </div>

          <div class="result-card"><div class="k" id="debtorIncomeRatioLabel">××—×•×– (×—×™×™×‘/×ª)</div><div class="v" id="debtorIncomeRatio">0%</div></div>
          <div class="result-card"><div class="k" id="partnerIncomeRatioLabel">××—×•×– (×‘×Ÿ/×‘×ª ×–×•×’)</div><div class="v" id="partnerIncomeRatio">0%</div></div>
          <div class="ratio-visual">
            <div id="barDebtor" class="ratio-bar-d"></div>
            <div id="barPartner" class="ratio-bar-p"></div>
          </div>

          <div class="result-card" id="debtorPaymentCard"><div class="k" id="debtorPaymentLabel">×ª×©×œ×•× ××•×¦×¢ (×—×™×™×‘/×ª)</div><div class="v" id="debtorPaymentResult">â‚ª 0</div></div>
          <div class="result-card" id="partnerPaymentCard" style="display:none"><div class="k" id="partnerPaymentLabel">×ª×©×œ×•× ××•×¦×¢ (×‘×Ÿ/×‘×ª ×–×•×’)</div><div class="v" id="partnerPaymentResult">â‚ª 0</div></div>

          <div class="result-card result-wide result-danger center-card" id="familyPaymentCard" style="display:none">
            <div class="k">×ª×©×œ×•× ×—×•×“×©×™ ×œ×ª× ××©×¤×—×ª×™</div>
            <div class="v" id="finalPaymentResult">â‚ª 0</div>
          </div>
        </div>
      </div>

      <div class="inputs-col">
        <div class="row status-row">
          <div class="input-group">
            <label>×¡×˜×˜×•×¡ ××©×¤×—×ª×™</label>
            <div class="toggles-line" id="familyTypeGroup">
              <button class="chip family-type active" data-type="×™×—×™×“/ × ×©×•×™ ×—×™ ×‘× ×¤×¨×“">×™×—×™×“</button>
              <button class="chip family-type" data-type="×¨×•×•×§/ ×’×¨×•×©/ ××œ××Ÿ">×¨×•×•×§/×’×¨×•×©</button>
              <button class="chip family-type" data-type="×–×•×’">×–×•×’</button>
            </div>
            <div class="toggles-line" style="margin-top:6px">
              <span>×™×œ×“×™×:</span>
              <input id="childrenCount" type="number" min="0" max="10" value="0" style="width:50px;text-align:center;">
              <button class="chip" id="addChildBtn">+</button>
            </div>
          </div>
          <div class="toggles-line">
            <button class="chip" id="debtorMaleBtn">×—×™×™×‘</button>
            <button class="chip" id="debtorFemaleBtn">×—×™×™×‘×ª</button>
            <button class="chip alert" id="jointBtn">×–×•×’ ×‘×”×œ×™×š?</button>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid var(--border);margin:8px 0">

        <div class="input-pair">
          <div class="input-group">
            <label id="lblSalaryD">×”×›× ×¡×” (×—×™×™×‘/×ª)</label>
            <input id="salaryDebtor" type="number" placeholder="0">
          </div>
          <div class="input-group">
            <label id="lblSalaryP">×”×›× ×¡×” (×‘×Ÿ/×‘×ª ×–×•×’)</label>
            <input id="salaryPartner" type="number" placeholder="0">
          </div>
        </div>

        <div class="row" style="justify-items:center; margin-top:8px">
          <div class="toggles-line">
            <button class="chip" id="btnAllowances">×§×¦×‘××•×ª</button>
            <button class="chip" id="btnAlimony">××–×•× ×•×ª</button>
          </div>
        </div>

        <div id="allowanceFields" class="row row-2" style="margin-top:6px;display:none">
          <div class="input-group"><label id="lblAllowD">×§×¦×‘×” (×—×™×™×‘/×ª)</label><input id="debtorAllowance" type="number"></div>
          <div class="input-group"><label id="lblAllowP">×§×¦×‘×” (×‘×Ÿ/×–×•×’)</label><input id="partnerAllowance" type="number"></div>
        </div>

        <div id="alimonyFields" class="row row-2" style="margin-top:6px;display:none">
          <div class="input-group"><label>×”×•×¦××•×ª ××–×•× ×•×ª</label><input id="alimonyExpenses" type="number"></div>
        </div>

        <div class="input-pair" style="margin-top:6px">
          <div class="input-group"><label>×—×¨×™×’×•×ª</label><input id="unusualExpenses" type="number"></div>
          <div class="input-group"><label>×˜×™×¤×•×œ/×¦×”×¨×•× ×™×</label><input id="childcareExpenses" type="number"></div>
        </div>

        <div class="report-trigger"><button class="report-btn" id="reportBtn">ğŸ“Œ ×¤×¨×˜×™ ×“×•×´×—</button></div>
        <div id="reportPanel" class="row row-3">
            <div class="input-group"><label>××¡×³ ×ª×™×§</label><input id="caseId" type="text"></div>
            <div class="input-group"><label>×¢×•×¨×š</label><input id="authorName" type="text"></div>
            <div class="input-group"><label>×ª××¨×™×š</label><input id="reportDate" type="text" class="readonly" readonly></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('yearBadge').textContent = `××¢×•×“×›×Ÿ ×œÖ¾${new Date().getFullYear()}`;
const fmt = n => new Intl.NumberFormat('he-IL',{style:'currency',currency:'ILS',minimumFractionDigits:0}).format(n||0);
const r10 = n => Math.floor((n||0)/10)*10;
const E = id => document.getElementById(id);

const els = {
  salaryD:E('salaryDebtor'), salaryP:E('salaryPartner'),
  allowD:E('debtorAllowance'), allowP:E('partnerAllowance'),
  unusual:E('unusualExpenses'), child:E('childcareExpenses'), alimony:E('alimonyExpenses'),
  tIncome:E('totalIncomeResult'), tExp:E('totalExpensesResult'),
  base:E('baseLivingCostResult'), kidsA:E('socialSecurityAllowance'),
  disp:E('disposableIncomeResult'),
  rDeb:E('debtorIncomeRatio'), rPar:E('partnerIncomeRatio'),
  barD:E('barDebtor'), barP:E('barPartner'),
  payDeb:E('debtorPaymentResult'), payPar:E('partnerPaymentResult'),
  famCard:E('familyPaymentCard'), payFam:E('finalPaymentResult'),
  partnerCard:E('partnerPaymentCard'), debtorPayCard:E('debtorPaymentCard'),
  joint:E('jointBtn'), male:E('debtorMaleBtn'), female:E('debtorFemaleBtn'),
  children:E('childrenCount'),
};

const livingBase = {"×™×—×™×“/ × ×©×•×™ ×—×™ ×‘× ×¤×¨×“":4556, "×¨×•×•×§/ ×’×¨×•×©/ ××œ××Ÿ":4556, "×–×•×’":6024};
const kidsMap = {0:0,1:169,2:383,3:597,4:811,5:980,6:1149,7:1318,8:1487,9:1656,10:1825};

let gender='×—×™×™×‘', joint=false, familyType = "×™×—×™×“/ × ×©×•×™ ×—×™ ×‘× ×¤×¨×“", childrenCount = 0;

function setGender(g){
  gender=g;
  els.male.classList.toggle('active', g==='×—×™×™×‘');
  els.female.classList.toggle('active', g==='×—×™×™×‘×ª');
  calc();
}
els.male.onclick=()=>setGender('×—×™×™×‘');
els.female.onclick=()=>setGender('×—×™×™×‘×ª');

els.joint.onclick=()=>{
  joint=!joint;
  els.joint.classList.toggle('active', joint);
  els.famCard.style.display= joint ? 'block' : 'none';
  els.partnerCard.style.display = joint ? 'block' : 'none';
  els.debtorPayCard.classList.toggle('solo-pay', !joint);
  calc();
};

E('btnAllowances').onclick=function(){ this.classList.toggle('active'); E('allowanceFields').style.display=this.classList.contains('active')?'grid':'none'; };
E('btnAlimony').onclick=function(){ this.classList.toggle('active'); E('alimonyFields').style.display=this.classList.contains('active')?'grid':'none'; };
E('reportBtn').onclick=()=>{ E('reportPanel').style.display='grid'; E('reportDate').value=new Date().toLocaleDateString('he-IL'); };

document.querySelectorAll('.family-type').forEach(btn=>{
  btn.onclick=()=>{
    familyType = btn.dataset.type;
    document.querySelectorAll('.family-type').forEach(b=>b.classList.toggle('active', b===btn));
    calc();
  };
});

function calc(){
  const base = (livingBase[familyType] || 4556) + (parseInt(els.children.value||0) * 1500);
  const kids = kidsMap[parseInt(els.children.value||0)] || 0;
  
  const dS=+els.salaryD.value||0, pS=+els.salaryP.value||0;
  const dA=+els.allowD.value||0, pA=+els.allowP.value||0;
  const un=+els.unusual.value||0, ch=+els.child.value||0, al=+els.alimony.value||0;

  const totalIncome = dS+pS+dA+pA+kids;
  const totalExp = base+un+ch+al;
  const disp = totalIncome - totalExp;

  els.base.textContent = fmt(base);
  els.kidsA.textContent = fmt(kids);
  els.tIncome.textContent = fmt(totalIncome);
  els.tExp.textContent = fmt(totalExp);
  els.disp.textContent = disp<=0 ? '××™×Ÿ ×”×›× ×¡×” ×¤× ×•×™×”' : fmt(disp);

  const sumRatio = dS+pS;
  const rD = sumRatio>0 ? dS/sumRatio : 0.5;
  const rP = sumRatio>0 ? pS/sumRatio : 0.5;

  els.rDeb.textContent = (rD*100).toFixed(0)+'%';
  els.rPar.textContent = (rP*100).toFixed(0)+'%';
  els.barD.style.width = (rD*100)+'%';
  els.barP.style.width = (rP*100)+'%';

  const payD = r10((disp*rD)/2);
  const payP = r10((disp*rP)/2);
  els.payDeb.textContent = fmt(Math.max(0,payD));
  els.payPar.textContent = fmt(Math.max(0,payP));

  if(joint){
    els.payFam.textContent = fmt(r10(Math.max(0,payD+payP)));
  }
}

[els.salaryD, els.salaryP, els.allowD, els.allowP, els.unusual, els.child, els.alimony, els.children].forEach(i=>i.oninput=calc);
E('btnReset').onclick=()=>location.reload();
calc();
</script>
</body>
</html>

\<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™× - ×’×¨×¡×” ××©×•×“×¨×’×ª</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root{
  --primary:#005f73; --secondary:#0a9396; --bg:#f4f7f9; --panel:#fff;
  --text:#1f2937; --label:#4b5563; --border:#dbe3ea; --accent:#ee9b00;
  --danger:#ae2012; --blue:#0a58ff; --muted:#6b7280;
  --maxw:950px;
}

*{box-sizing:border-box}
body{
  font-family:'Heebo',sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
  padding:15px;
  display:flex;
  justify-content:center;
  min-height:100vh
}

.calculator{width:100%;max-width:var(--maxw)}
header{
  background:var(--primary);color:#fff;border-radius:14px;box-shadow:0 8px 22px rgba(0,0,0,.1);
  padding:12px 14px;display:flex;align-items:center;justify-content:center;position:relative;margin-bottom:15px;
}
header h1{margin:0;font-size:1.4rem;}

.board{
  display:grid;grid-template-columns: 1.1fr 0.9fr; gap:15px;
}

.inputs-col, .results-col{
  background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:15px; box-shadow:0 4px 12px rgba(0,0,0,0.03);
}
.results-col{ background:#eaf6f6; }

.section-title{margin:10px 0 12px;color:var(--primary);font-size:1rem;font-weight:700;text-align:center;border-bottom:1px solid #eee;padding-bottom:5px}

/* ×›×¤×ª×•×¨×™× ××—×™×“×™× */
.toggles-line{display:flex;gap:8px;align-items:center;justify-content:center;flex-wrap:wrap;margin:10px 0}
.chip{
  padding:8px 15px; border:1px solid #cfd8e3; border-radius:10px;
  background:#fff; cursor:pointer; font-size:0.9rem; font-weight:500;
  transition: all 0.2s; flex: 1; min-width: 100px; display: flex; justify-content: center; align-items: center; text-align: center;
}
.chip.active{background:var(--secondary); color:#fff; border-color:var(--secondary);}
.chip.alert.active{background:var(--danger); border-color:var(--danger);}

.input-group{display:flex;flex-direction:column;margin-bottom:10px}
.input-group label{font-weight:600; color:var(--label); font-size:0.9rem; margin-bottom:4px; display:flex; align-items:center; gap:5px;}
input, select, textarea{
  border:1px solid var(--border); padding:8px; border-radius:8px; font-size:0.95rem; background:#fbfeff; width:100%;
}
.note-input{
  margin-top:4px; font-size:0.8rem; border:1px dashed #cbd5e1; height:40px; background:#fffdf5; resize:none;
}

.result-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.result-card{background:#fff;border:1px solid #dbe9ea;border-radius:10px;padding:10px;text-align:center}
.result-card .k{color:var(--muted);font-weight:500;font-size:0.85rem}
.result-card .v{margin-top:4px;font-weight:700;color:var(--accent);font-size:1.1rem}
.result-wide{grid-column:1/-1}
.result-big .v{font-size:1.3rem;color:var(--blue)}
.result-danger .v{color:var(--danger)}

.allowance-row{display:grid; grid-template-columns: 1fr 1fr auto; gap:5px; margin-bottom:5px;}
.info-btn{width:18px;height:18px;border-radius:50%;background:#eef6f6;color:#0d6b6b;display:inline-flex;align-items:center;justify-content:center;font-size:.7rem;border:1px solid #d4e7e7;cursor:pointer}

@media (max-width:850px){
  .board{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="calculator" id="calcRoot">
  <header>
    <h1>××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™×</h1>
  </header>

  <div class="board">
    <div class="inputs-col">
      <div class="section-title">× ×ª×•× ×™ ×™×¡×•×“</div>
      <div class="input-group">
        <label>×¡×˜×˜×•×¡ ××©×¤×—×ª×™</label>
        <div class="toggles-line">
          <button class="chip family-type active" data-val="×™×—×™×“">×™×—×™×“/×—×™ ×‘× ×¤×¨×“</button>
          <button class="chip family-type" data-val="×¨×•×•×§_×™×œ×“">×¨×•×•×§+×™×œ×“/×’×¨×•×©</button>
          <button class="chip family-type" data-val="×–×•×’">×–×•×’</button>
        </div>
      </div>

      <div class="toggles-line">
        <div class="input-group" style="flex:1">
          <label>××¡×³ ×™×œ×“×™×</label>
          <input id="kidsCount" type="number" value="0" min="0" oninput="calc()">
        </div>
        <div class="input-group" style="flex:1">
          <label>××™ ×‘×”×œ×™×š?</label>
          <div class="toggles-line" style="margin:0">
            <button class="chip active" id="genM" onclick="setGen('×—×™×™×‘')">×—×™×™×‘</button>
            <button class="chip" id="genF" onclick="setGen('×—×™×™×‘×ª')">×—×™×™×‘×ª</button>
          </div>
        </div>
      </div>

      <div class="section-title">×”×›× ×¡×•×ª × ×˜×• (â‚ª)</div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
        <div class="input-group">
          <label id="lblSalD">×©×›×¨ (×—×™×™×‘)</label>
          <input id="salD" type="number" oninput="calc()">
        </div>
        <div class="input-group">
          <label id="lblSalP">×©×›×¨ (×‘×Ÿ/×‘×ª ×–×•×’)</label>
          <input id="salP" type="number" oninput="calc()">
        </div>
      </div>

      <div class="input-group">
        <label>×”×›× ×¡×•×ª × ×•×¡×¤×•×ª <span class="info-btn" title="×©×›×™×¨×•×ª, ×¤×¨×™×œ× ×¡ ×•×›×•'">?</span></label>
        <input id="otherInc" type="number" oninput="calc()">
        <textarea class="note-input" id="otherIncNote" placeholder="×¤×™×¨×•×˜ ×”×›× ×¡×•×ª × ×•×¡×¤×•×ª..."></textarea>
      </div>

      <button class="chip" style="width:100%; margin-bottom:10px" onclick="toggleSection('allowBox')">ğŸ’° ×§×¦×‘××•×ª ×‘×™×˜×•×— ×œ××•××™</button>
      <div id="allowBox" style="display:none; background:#f8fafc; padding:10px; border-radius:10px; margin-bottom:15px">
        <div id="allowList"></div>
        <button class="chip" style="font-size:0.8rem; min-width:auto" onclick="addAllow()">+ ×”×•×¡×£ ×§×¦×‘×”</button>
      </div>

      <div class="section-title">×”×•×¦××•×ª ×•×”×¤×—×ª×•×ª (â‚ª)</div>
      <div class="toggles-line">
        <button class="chip" id="btnJoint" onclick="toggleJoint()">×©× ×™ ×‘× ×™ ×”×–×•×’ ×‘×”×œ×™×š?</button>
        <button class="chip" id="btnSpecial" onclick="toggleSection('specialBox')">×”×•×¦××•×ª ××™×•×—×“×•×ª</button>
        <button class="chip" id="btnAlimony" onclick="toggleSection('alimonyBox')">××–×•× ×•×ª</button>
      </div>

      <div id="jointBox" style="display:none; margin-bottom:10px">
        <div class="input-group">
          <label>×ª×©×œ×•× ×—×•×“×©×™ ×‘×ª×™×§ ×¨××©×•×Ÿ ×‘×–××Ÿ (â‚ª)</label>
          <input id="firstCaseAmount" type="number" oninput="calc()" placeholder="×”×–×Ÿ ×¡×›×•×...">
        </div>
      </div>

      <div id="specialBox" style="display:none; background:#fef2f2; padding:10px; border-radius:10px; margin-bottom:10px">
        <div class="input-group">
          <label>×”×•×¦××•×ª ×—×¨×™×’×•×ª (×¨×¤×•××™/××—×¨)</label>
          <input id="expSpecial" type="number" oninput="calc()">
          <textarea class="note-input" id="expSpecialNote" placeholder="×¤×™×¨×•×˜ ×”×•×¦××•×ª ×—×¨×™×’×•×ª..."></textarea>
        </div>
        <div class="input-group">
          <label>×˜×™×¤×•×œ ×•×¦×”×¨×•× ×™× <span class="info-btn" title="×¢×“ ×›×™×ª×” ×’'">?</span></label>
          <input id="expChildcare" type="number" oninput="calc()">
          <textarea class="note-input" id="expChildcareNote" placeholder="×¤×™×¨×•×˜ ×¦×”×¨×•× ×™×..."></textarea>
        </div>
      </div>

      <div id="alimonyBox" style="display:none; margin-bottom:10px">
        <div class="input-group">
          <label>×”×•×¦××•×ª ××–×•× ×•×ª (â‚ª)</label>
          <input id="expAlimony" type="number" oninput="calc()">
        </div>
      </div>
    </div>

    <div class="results-col">
      <div class="section-title">×ª×•×¦××•×ª ×”×—×™×©×•×‘</div>
      <div class="result-grid">
        <div class="result-card"><div class="k">×¡×š ×”×›× ×¡×•×ª</div><div class="v" id="resInc">â‚ª 0</div></div>
        <div class="result-card"><div class="k">×“××™ ××—×™×™×”</div><div class="v" id="resLiving">â‚ª 0</div></div>
        <div class="result-card result-wide result-big">
          <div class="k">×”×›× ×¡×” ×¤× ×•×™×” ×œ×ª× ×”××©×¤×—×ª×™</div>
          <div class="v" id="resDisp">××™×Ÿ ×”×›× ×¡×” ×¤× ×•×™×”</div>
        </div>
        <div class="result-card"><div class="k" id="resLblRatioD">××—×•×– (×—×™×™×‘)</div><div class="v" id="resRatioD">0%</div></div>
        <div class="result-card"><div class="k" id="resLblRatioP">××—×•×– (×‘×Ÿ ×–×•×’)</div><div class="v" id="resRatioP">0%</div></div>
        
        <div class="result-card result-wide result-danger">
          <div class="k">×¡×›×•× ×©× ×§×‘×¢</div>
          <div class="v" id="resFinal" style="font-size:1.6rem">â‚ª 0</div>
        </div>
      </div>

      <div style="margin-top:20px">
        <div class="section-title">×”×¡×‘×¨</div>
        <textarea id="finalExpNote" style="height:100px; border-style:solid" placeholder="× ×™××•×§×™× ×•×”×¡×‘×¨×™× ×œ×§×‘×™×¢×ª ×”×¦×•..."></textarea>
      </div>

      <div class="toggles-line" style="margin-top:20px">
        <button class="chip" style="background:#fff" onclick="window.print()">ğŸ–¨ï¸ ×”×“×¤×¡×”</button>
        <button class="chip" style="background:#fff" onclick="doReset()">â†º ××™×¤×•×¡</button>
      </div>
    </div>
  </div>
</div>

<script>
const fmt = (n) => new Intl.NumberFormat('he-IL').format(n || 0) + ' â‚ª';
let gender = '×—×™×™×‘', isJoint = false, familyVal = '×™×—×™×“';

const baseLiving = { "×™×—×™×“": 4556, "×¨×•×•×§_×™×œ×“": 6056, "×–×•×’": 6024 };
const allowTypes = ["× ×›×•×ª ×›×œ×œ×™×ª", "×–×§× ×”", "××‘×˜×œ×”", "×™×œ×“×™×", "×”×‘×˜×—×ª ×”×›× ×¡×”", "×¡×™×¢×•×“", "××—×¨"];

function toggleSection(id) {
  const el = document.getElementById(id);
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
}

function toggleJoint() {
  isJoint = !isJoint;
  document.getElementById('btnJoint').classList.toggle('active', isJoint);
  document.getElementById('jointBox').style.display = isJoint ? 'block' : 'none';
  calc();
}

function setGen(g) {
  gender = g;
  document.getElementById('genM').classList.toggle('active', g === '×—×™×™×‘');
  document.getElementById('genF').classList.toggle('active', g === '×—×™×™×‘×ª');
  const p = (g === '×—×™×™×‘') ? '×‘×ª ×–×•×’' : '×‘×Ÿ ×–×•×’';
  document.getElementById('lblSalD').innerText = `×©×›×¨ (${g})`;
  document.getElementById('lblSalP').innerText = `×©×›×¨ (${p})`;
  document.getElementById('resLblRatioD').innerText = `××—×•×– (${g})`;
  document.getElementById('resLblRatioP').innerText = `××—×•×– (${p})`;
  calc();
}

document.querySelectorAll('.family-type').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('.family-type').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    familyVal = btn.dataset.val;
    calc();
  }
});

function addAllow() {
  const div = document.createElement('div');
  div.className = 'allowance-row';
  let options = allowTypes.map(t => `<option>${t}</option>`).join('');
  div.innerHTML = `<select>${options}</select><input type="number" oninput="calc()" placeholder="×¡×›×•×"><button class="info-btn" onclick="this.parentElement.remove();calc()">X</button>`;
  document.getElementById('allowList').appendChild(div);
}

function calc() {
  // ×”×›× ×¡×•×ª
  const sD = parseFloat(document.getElementById('salD').value) || 0;
  const sP = parseFloat(document.getElementById('salP').value) || 0;
  const oI = parseFloat(document.getElementById('otherInc').value) || 0;
  
  let totalAllow = 0;
  document.querySelectorAll('#allowList input').forEach(i => totalAllow += parseFloat(i.value) || 0);
  
  const totalInc = sD + sP + oI + totalAllow;
  
  // ×”×•×¦××•×ª ××—×™×™×”
  const kids = parseInt(document.getElementById('kidsCount').value) || 0;
  const livingBase = baseLiving[familyVal] || 4556;
  const livingTotal = livingBase + (kids <= 4 ? kids * 1500 : (4 * 1500 + (kids - 4) * 1300));
  
  // ×”×•×¦××•×ª × ×•×¡×¤×•×ª
  const eS = parseFloat(document.getElementById('expSpecial').value) || 0;
  const eC = parseFloat(document.getElementById('expChildcare').value) || 0;
  const eA = parseFloat(document.getElementById('expAlimony').value) || 0;
  
  let disp = totalInc - livingTotal - eS - eC - eA;
  
  // ×× ×’× ×•×Ÿ ×‘× ×™ ×–×•×’ (×ª×™×§ ×¨××©×•×Ÿ ×‘×–××Ÿ)
  if (isJoint) {
    const firstCase = parseFloat(document.getElementById('firstCaseAmount').value) || 0;
    disp = disp - firstCase;
  }

  // ×™×—×¡×™×
  const debtorPart = sD + (oI/2);
  const ratioD = totalInc > 0 ? (debtorPart / totalInc) : 0;
  
  // ×¡×›×•× ×¡×•×¤×™ - ×—×¦×™ ××”×”×›× ×¡×” ×”×¤× ×•×™×” ×”×™×—×¡×™×ª
  let final = 0;
  if (disp > 0) {
    final = Math.floor((disp * ratioD) / 2);
  }

  // ×ª×¦×•×’×”
  document.getElementById('resInc').innerText = fmt(totalInc);
  document.getElementById('resLiving').innerText = fmt(livingTotal);
  document.getElementById('resDisp').innerText = disp > 0 ? fmt(disp) : '××™×Ÿ ×”×›× ×¡×” ×¤× ×•×™×”';
  document.getElementById('resRatioD').innerText = (ratioD * 100).toFixed(1) + '%';
  document.getElementById('resRatioP').innerText = ((1 - ratioD) * 100).toFixed(1) + '%';
  document.getElementById('resFinal').innerText = fmt(Math.max(0, final));
}

function doReset() {
  if(confirm("×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™×?")) location.reload();
}

calc();
</script>
</body>
</html>

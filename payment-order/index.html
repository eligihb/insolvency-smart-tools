<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>YE Smart Calculator 2026</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root {
  --primary: #1e293b; 
  --secondary: #0f172a;
  --panel: #334155; 
  --accent: #38bdf8;
  --danger: #fb7185;
  --success: #34d399;
  --text: #ffffff;
  --label: #cbd5e1;
  --border: #475569;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
  font-family: 'Heebo', sans-serif;
  background: #f1f5f9;
  margin: 0; padding: 0;
  display: flex; justify-content: center;
  min-height: 100vh; color: var(--text);
}

/* Container */
.app-container {
  width: 100%; max-width: 1100px;
  background: var(--inner-bg);
  min-height: 100vh;
  display: flex; flex-direction: column;
}

@media (min-width: 768px) {
  .app-container {
    margin: 20px; border-radius: 24px; min-height: auto;
    background: var(--primary); box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
    overflow: hidden;
  }
}

/* Stepper */
.stepper {
  background: var(--secondary);
  padding: 20px; display: flex; justify-content: space-between;
  border-bottom: 1px solid var(--border);
}
.step-item {
  display: flex; flex-direction: column; align-items: center; flex: 1;
  position: relative; opacity: 0.4; transition: 0.3s;
}
.step-item.active { opacity: 1; }
.step-circle {
  width: 32px; height: 32px; border-radius: 50%;
  background: var(--panel); border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-weight: 900; margin-bottom: 5px; font-size: 14px;
}
.step-item.active .step-circle {
  background: var(--accent); border-color: var(--accent); color: var(--secondary);
}
.step-label { font-size: 11px; font-weight: 700; color: var(--label); }

/* Main Content */
.main-content { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
.screen { display: none; animation: fadeIn 0.4s ease; }
.screen.active { display: block; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* UI Elements */
.section-card {
  background: var(--panel); border-radius: 20px; padding: 20px;
  margin-bottom: 20px; border: 1px solid var(--border);
}
.title-row { text-align: center; margin-bottom: 20px; }
.title-row h2 { margin: 0; font-size: 1.5rem; font-weight: 800; color: #fff; }
.title-row p { color: var(--label); margin: 5px 0 0; font-size: 0.9rem; }

.input-group { margin-bottom: 18px; }
.input-group label { display: block; font-size: 0.95rem; font-weight: 600; color: var(--label); margin-bottom: 8px; text-align: center; }

input, select, textarea {
  width: 100%; padding: 14px; border-radius: 12px;
  background: var(--secondary); border: 1px solid var(--border);
  color: #fff; font-size: 1.1rem; font-weight: 700; text-align: center;
}
.amt-input { color: var(--accent) !important; font-size: 1.4rem; }

.chip-group { display: flex; gap: 10px; margin-top: 5px; }
.chip {
  flex: 1; padding: 12px; background: var(--secondary);
  border: 1px solid var(--border); border-radius: 12px;
  color: #fff; font-weight: 700; cursor: pointer; text-align: center;
  transition: 0.2s; font-size: 0.95rem; display: flex; align-items: center; justify-content: center;
}
.chip.active { background: var(--accent); color: var(--secondary); border-color: var(--accent); }

/* Result Cards */
.result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.res-card {
  background: var(--secondary); padding: 15px; border-radius: 16px;
  border: 1px solid var(--border); text-align: center;
}
.res-card .label { color: var(--label); font-size: 0.85rem; margin-bottom: 4px; }
.res-card .val { font-size: 1.2rem; font-weight: 800; }
.res-card.big { grid-column: 1 / -1; background: rgba(56, 189, 248, 0.05); }
.res-card.big .val { font-size: 1.8rem; color: var(--accent); }

/* Navigation */
.nav-footer {
  padding: 20px; background: var(--secondary);
  display: flex; justify-content: space-between; gap: 15px;
}
.btn-nav {
  padding: 16px 24px; border-radius: 14px; border: none;
  font-weight: 800; font-size: 1.1rem; cursor: pointer; flex: 1;
  transition: 0.2s;
}
.btn-next { background: var(--accent); color: var(--secondary); }
.btn-back { background: var(--panel); color: #fff; }
.btn-next:disabled { opacity: 0.3; cursor: not-allowed; }

/* Entry Panel */
#entryPanel {
  background: rgba(0,0,0,0.4); border: 2px dashed var(--accent);
  padding: 20px; border-radius: 20px; margin-top: 15px; position: relative;
}

.list-item {
  background: var(--secondary); padding: 12px; border-radius: 12px;
  margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;
  border-right: 4px solid var(--accent);
}

.insight-box {
  background: rgba(56, 189, 248, 0.1); border-right: 6px solid var(--accent);
  padding: 20px; border-radius: 16px; line-height: 1.7; font-size: 1rem;
}

.info-icon {
  display: inline-block; width: 18px; height: 18px; background: var(--accent);
  color: #000; border-radius: 50%; font-size: 12px; line-height: 18px;
  text-align: center; margin-left: 5px; cursor: help;
}

@media print {
    .nav-footer, .stepper, .btn-ctrl, .category-btn-group { display: none !important; }
    .screen { display: block !important; opacity: 1 !important; transform: none !important; }
    body { background: #fff; color: #000; }
    .res-card, .section-card, .list-item { background: #fff !important; border: 1px solid #000 !important; color: #000 !important; }
}

</style>
</head>
<body>

<div class="app-container" id="calcRoot">
  <div class="stepper">
    <div class="step-item active" id="s1">
      <div class="step-circle">1</div>
      <div class="step-label">×‘×¡×™×¡</div>
    </div>
    <div class="step-item" id="s2">
      <div class="step-circle">2</div>
      <div class="step-label">×ª×•×¡×¤×•×ª</div>
    </div>
    <div class="step-item" id="s3">
      <div class="step-circle">3</div>
      <div class="step-label">×ª×•×¦××”</div>
    </div>
    <div class="step-item" id="s4">
      <div class="step-circle">4</div>
      <div class="step-label">×ª×•×‘× ×•×ª</div>
    </div>
  </div>

  <div class="main-content">
    
    <div class="screen active" id="screen1">
      <div class="title-row">
        <h2>× ×ª×•× ×™ ×‘×¡×™×¡ ×•×”×›× ×¡×•×ª</h2>
        <p>×”×–×Ÿ ××ª × ×ª×•× ×™ ×”×ª× ×”××©×¤×—×ª×™ ×•×”×©×›×¨</p>
      </div>

      <div class="section-card">
        <div class="input-group">
          <label>××¦×‘ ××©×¤×—×ª×™</label>
          <div class="chip-group">
            <button class="chip family-btn active" data-type="×™×—×™×“">×™×—×™×“</button>
            <button class="chip family-btn" data-type="×–×•×’">×–×•×’</button>
            <button class="chip family-btn" data-type="×¨×•×•×§">×¨×•×•×§/×’×¨×•×©</button>
          </div>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
          <div class="input-group">
            <label>×™×œ×“×™× (×¢×“ 18)</label>
            <input type="number" id="kidsInput" value="0" min="0" oninput="calc()">
          </div>
          <div class="input-group">
            <label>××™ ×‘×”×œ×™×š?</label>
            <div class="chip-group">
              <button class="chip gender-btn active" onclick="setGen('×—×™×™×‘', this)">×—×™×™×‘</button>
              <button class="chip gender-btn" onclick="setGen('×—×™×™×‘×ª', this)">×—×™×™×‘×ª</button>
            </div>
          </div>
        </div>
      </div>

      <div class="section-card">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
          <div class="input-group">
            <label>×”×›× ×¡×” ×—×™×™×‘/×ª</label>
            <input type="text" id="incD" class="amt-input live-curr" placeholder="0">
          </div>
          <div class="input-group">
            <label>×”×›× ×¡×” ×‘×Ÿ ×–×•×’</label>
            <input type="text" id="incP" class="amt-input live-curr" placeholder="0">
          </div>
        </div>
      </div>
    </div>

    <div class="screen" id="screen2">
      <div class="title-row">
        <h2>×§×¦×‘××•×ª ×•×”×•×¦××•×ª ××™×•×—×“×•×ª</h2>
        <p>×›×›×œ ×•×™×© ×”×•×¦××•×ª × ×•×¡×¤×•×ª ×”×–×Ÿ ××•×ª×Ÿ, ×× ×œ× ×”××©×š ×œ××¡×š ×”×‘×</p>
      </div>

      <div class="section-card">
        <div class="chip-group" style="flex-wrap:wrap;">
          <button class="chip" onclick="openEntry('allowance')">×§×¦×‘××•×ª â•</button>
          <button class="chip" onclick="openEntry('special')">×”×•×¦××•×ª â•</button>
          <button class="chip" onclick="openEntry('alimony')">××–×•× ×•×ª â•</button>
        </div>

        <div id="entryPanel" style="display:none;">
            <div class="close-x" onclick="closeEntry()" style="position:absolute; top:10px; left:10px; cursor:pointer; color:var(--danger); font-weight:900;">âœ–</div>
            <select id="eType" style="margin-bottom:10px;"></select>
            <input id="eAmt" type="text" class="live-curr" placeholder="â‚ª ×¡×›×•×" style="margin-bottom:10px;">
            <input id="eNote" type="text" placeholder="×”×¢×¨×” / ×¤×™×¨×•×˜" style="margin-bottom:10px;">
            <button class="chip active" onclick="addEntry()" style="width:100%;">×”×•×¡×£ ×œ×¨×©×™××” âœ…</button>
        </div>
      </div>

      <div id="listDisplay"></div>
    </div>

    <div class="screen" id="screen3">
        <div class="title-row">
          <h2>×¡×™×›×•× ×—×™×©×•×‘</h2>
        </div>
        <div class="result-grid">
            <div class="res-card"><div class="label">×¡×”"×› ×”×›× ×¡×•×ª</div><div id="rInc" class="val">0 â‚ª</div></div>
            <div class="res-card"><div class="label">×“××™ ××—×™×™×”</div><div id="rBase" class="val">0 â‚ª</div></div>
            <div class="res-card"><div class="label">×¡×”"×› ×”×•×¦××•×ª</div><div id="rExp" class="val">0 â‚ª</div></div>
            <div class="res-card"><div class="label">×§×¦×‘×ª ×™×œ×“×™×</div><div id="rKids" class="val">0 â‚ª</div></div>
            <div class="res-card big">
                <div class="label">×”×›× ×¡×” ×¤× ×•×™×”</div>
                <div id="rDisp" class="val">×¢×œ ×¤×™ ×”× ×ª×•× ×™× ××™×Ÿ ×”×›× ×¡×” ×¤× ×•×™×”</div>
            </div>
            <div class="res-card big" style="border: 2px solid var(--accent);">
                <div class="label">×ª×©×œ×•× ×—×•×“×©×™ ××•×¦×¢</div>
                <div id="rFinal" class="val" style="color:var(--danger)">0 â‚ª</div>
                <div id="rManual" style="font-size:0.8rem; font-style:italic; margin-top:5px; display:none;"></div>
            </div>
        </div>
        
        <div style="text-align:center; margin-top:15px;">
            <button class="chip" onclick="toggleManual()" style="max-width:200px; margin:auto;">×©× ×” ×¡×›×•× ×™×“× ×™×ª</button>
            <div id="mBox" style="display:none; margin-top:10px; background:var(--secondary); padding:15px; border-radius:15px;">
                <input id="mAmt" type="text" class="live-curr" placeholder="×¡×›×•× ×—×“×©" style="margin-bottom:10px;">
                <textarea id="mNote" placeholder="× ×™××•×§ ×œ×©×™× ×•×™..."></textarea>
                <button class="chip active" onclick="applyManual()" style="margin-top:10px;">×¢×“×›×Ÿ âš¡</button>
            </div>
        </div>
    </div>

    <div class="screen" id="screen4">
        <div class="title-row">
            <h2>×ª×•×‘× ×•×ª ×•× ×™×ª×•×— ××§×¦×•×¢×™</h2>
        </div>
        <div id="insightBox" class="insight-box"></div>
        <div style="margin-top:30px; display:flex; gap:10px;">
            <button class="btn-nav" onclick="window.print()" style="background:#000;">×”×“×¤×¡ PDF ğŸ–¨ï¸</button>
            <button class="btn-nav" id="btnShot" style="background:var(--success); color:#000;">×©××•×¨ ×ª××•× ×” ğŸ“¸</button>
        </div>
    </div>

  </div>

  <div class="nav-footer">
    <button class="btn-nav btn-back" id="prevBtn" onclick="changeStep(-1)" style="visibility:hidden;">×—×–×•×¨</button>
    <button class="btn-ctrl" onclick="resetAll()" style="background:none; border:1px solid var(--border); color:var(--danger); flex:0.5;">××™×¤×•×¡</button>
    <button class="btn-nav btn-next" id="nextBtn" onclick="changeStep(1)">×”××©×š</button>
  </div>

  <footer style="background:var(--secondary); padding:15px; text-align:center; font-size:12px; color:var(--label);">
    YE Smart Solutions - ×—×“×œ×•×ª ×¤×™×¨×¢×•×Ÿ 2026 &copy;
  </footer>
</div>

<script>
const E = id => document.getElementById(id);
const parseV = s => parseInt(String(s||'').replace(/[^\d]/g,'')) || 0;
const formatV = n => n > 0 ? new Intl.NumberFormat('he-IL').format(n) + ' â‚ª' : '0 â‚ª';

let currentStep = 1;
let state = { incomes:[], expenses:[], gender:'×—×™×™×‘', family:'×™×—×™×“', isManual: false };
const config = { base: { "×™×—×™×“": 4711, "×¨×•×•×§": 4711, "×–×•×’": 6229 }, kidsSS: { 0:0, 1:173, 2:392, 3:611, 4:830, 5:1003 } };

// Live Formatting
document.querySelectorAll('.live-curr').forEach(el => {
    el.addEventListener('input', e => {
        let n = parseV(e.target.value);
        e.target.value = n > 0 ? formatV(n) : '';
        calc();
    });
});

function changeStep(n) {
    currentStep += n;
    if(currentStep < 1) currentStep = 1;
    if(currentStep > 4) currentStep = 4;
    updateUI();
}

function updateUI() {
    document.querySelectorAll('.screen').forEach((s, i) => s.classList.toggle('active', i+1 === currentStep));
    document.querySelectorAll('.step-item').forEach((s, i) => s.classList.toggle('active', i+1 <= currentStep));
    
    E('prevBtn').style.visibility = currentStep === 1 ? 'hidden' : 'visible';
    E('nextBtn').textContent = currentStep === 4 ? '×¡×™×™×' : '×”××©×š';
    if(currentStep === 4) E('nextBtn').style.display = 'none'; else E('nextBtn').style.display = 'block';
    
    window.scrollTo(0,0);
    calc();
}

// Logic
function setGen(g, btn) {
    state.gender = g;
    document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    calc();
}

document.querySelectorAll('.family-btn').forEach(btn => {
    btn.onclick = () => {
        document.querySelectorAll('.family-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.family = btn.dataset.type;
        calc();
    };
});

function openEntry(mode) {
    state.mode = mode;
    E('entryPanel').style.display = 'block';
    const s = E('eType'); s.innerHTML = '';
    if(mode === 'allowance') ['× ×›×•×ª', '×–×§× ×”', '×”×‘×˜×—×ª ×”×›× ×¡×”', '××—×¨'].forEach(o => s.add(new Option(o, o)));
    else if(mode === 'special') ['×—×¨×™×’×•×ª', '×¦×”×¨×•×Ÿ', '×˜×™×¤×•×œ ×‘×™×œ×“', '×ª×©×œ×•× ×—×•×“×©×™ ×‘×Ÿ ×–×•×’ (×‘×”×œ×™×š)', '××—×¨'].forEach(o => s.add(new Option(o, o)));
    else s.add(new Option('××–×•× ×•×ª', '××–×•× ×•×ª'));
}

function addEntry() {
    const amt = parseV(E('eAmt').value);
    if(amt > 0) {
        const item = { type: E('eType').value, amt, note: E('eNote').value };
        if(state.mode === 'allowance') state.incomes.push(item); else state.expenses.push(item);
        E('eAmt').value = ''; E('eNote').value = ''; E('entryPanel').style.display = 'none';
        renderList(); calc();
    }
}

function renderList() {
    const combined = [...state.incomes, ...state.expenses];
    E('listDisplay').innerHTML = combined.map((item, i) => `
        <div class="list-item">
            <div><b>${item.type}</b> <br> <small>${item.note}</small></div>
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="color:var(--accent); font-weight:800;">${formatV(item.amt)}</span>
                <span onclick="removeEntry(${i})" style="color:var(--danger); cursor:pointer; font-size:1.2rem;">âœ–</span>
            </div>
        </div>
    `).join('');
}

function removeEntry(i) {
    const totalIncomes = state.incomes.length;
    if(i < totalIncomes) state.incomes.splice(i, 1);
    else state.expenses.splice(i - totalIncomes, 1);
    renderList(); calc();
}

function toggleManual() { E('mBox').style.display = E('mBox').style.display === 'none' ? 'block' : 'none'; }
function applyManual() { state.isManual = true; E('mBox').style.display = 'none'; calc(); }

function calc() {
    const kids = parseInt(E('kidsInput').value || 0);
    const kidsAdd = kids <= 4 ? kids * 1500 : (4 * 1500) + ((kids - 4) * 1300);
    const baseP = (config.base[state.family] || 4711) + kidsAdd;
    const kSS = kids <= 5 ? config.kidsSS[kids] : 1003 + (kids-5)*173;

    const dSal = parseV(E('incD').value), pSal = parseV(E('incP').value);
    const allowT = state.incomes.reduce((s, a) => s + a.amt, 0);
    const spouseP = state.expenses.filter(e => e.type.includes('×‘×Ÿ ×–×•×’')).reduce((s, a) => s + a.amt, 0);
    const alimonyE = state.expenses.filter(e => e.type === '××–×•× ×•×ª').reduce((s, a) => s + a.amt, 0);
    const otherE = state.expenses.filter(e => !e.type.includes('××–×•× ×•×ª') && !e.type.includes('×‘×Ÿ ×–×•×’')).reduce((s, a) => s + a.amt, 0);

    const totalI = dSal + pSal + allowT + kSS;
    const totalE = baseP + otherE + alimonyE + spouseP;
    const disp = totalI - totalE;

    E('rInc').textContent = formatV(totalI); E('rBase').textContent = formatV(baseP);
    E('rExp').textContent = formatV(totalE); E('rKids').textContent = formatV(kSS);

    const pD = Math.round((dSal / (dSal + pSal || 1)) * 100);
    E('barD').style.width = pD + "%"; E('barD').textContent = pD > 10 ? pD + "%" : "";
    E('barP').style.width = (100-pD) + "%"; E('barP').textContent = (100-pD) > 10 ? (100-pD) + "%" : "";
    E('resRatioD').textContent = "×—×™×™×‘: " + pD + "%"; E('resRatioP').textContent = "×‘×Ÿ ×–×•×’: " + (100-pD) + "%";

    const now = new Date(); const minWage = (now.getMonth() >= 3 || now.getFullYear() > 2026) ? 6443.85 : 6248;
    let insights = [`<b>×ª×•×‘× ×•×ª ××§×¦×•×¢×™×•×ª</b> ×¢×‘×•×¨ ${state.family === '×–×•×’' ? '×–×•×’' : '×™×—×™×“'} ${kids > 0 ? '×¢× ' + kids + ' ×™×œ×“×™×' : ''}:`];
    insights.push(`×“××™ ×”××—×™×” ×”××•×’× ×™× (×›×•×œ×œ ××’×•×¨×™×) × ×§×‘×¢×• ×¢×œ ×¡×š ×©×œ ${formatV(baseP)}.`);

    const tzTotal = state.expenses.filter(e => e.type === '×¦×”×¨×•×Ÿ').reduce((s, a) => s + a.amt, 0);
    if(kids > 0 && tzTotal > (kids * 1000)) insights.push(`âš ï¸ ×”×•×¦××•×ª ×¦×”×¨×•×Ÿ (â‚ª${formatV(tzTotal)}) ×—×•×¨×’×•×ª ××”×ª×§×¨×” ×”××•×›×¨×ª ×©×œ 1,000 â‚ª ×œ×™×œ×“.`);
    
    if (state.incomes.some(i => i.type === '× ×›×•×ª')) insights.push("×”×ª× ××ª×§×™×™× ××’××œ××•×ª ××•×’× ×•×ª (× ×›×•×ª) ×©××™× ×Ÿ ×—×œ×§ ×× ×›×¡×™ ×”×§×•×¤×”.");
    if (spouseP > 0) insights.push("×”×•×¤×—×ª ×ª×©×œ×•× ×‘×Ÿ ×–×•×’ ×”×× ×•×”×œ ×›×ª×™×§ ×¨××©×•×Ÿ ×‘×–××Ÿ.");

    if (disp <= 0) {
        E('rDisp').textContent = "××™×Ÿ ×”×›× ×¡×” ×¤× ×•×™×”";
        E('rFinal').textContent = (dSal === 0 && allowT > 0) ? "×ª×™×§ ××¤×¡" : "0 â‚ª";
        if (dSal === 0 && allowT === 0) insights.push("×‘×”×™×¢×“×¨ ×”×›× ×¡×”, ×™×•×˜×œ ×ª×©×œ×•× ×©×œ 150 â‚ª ×œ××©×š 3 ×—×•×“×©×™×.");
    } else {
        E('rDisp').textContent = formatV(disp);
        const calcPay = Math.floor(((disp * (dSal / (dSal + pSal || 1))) / 2) / 10) * 10;
        E('rFinal').textContent = state.isManual ? formatV(parseV(E('mAmt').value)) : (calcPay === 0 ? "×ª×™×§ ××¤×¡" : formatV(calcPay));
        if (state.isManual) {
            insights.push(`<b>×©×™× ×•×™ ×™×“× ×™:</b> ×”×¡×›×•× ×¢×•×“×›×Ÿ ×œ-${formatV(parseV(E('mAmt').value))} ×× ×™××•×§: ${E('mNote').value}`);
        }
        insights.push(`×”×××•× ×” ××•×ª×™×¨ 50% ××”×¤× ×•×™×” ×›<b>×ª××¨×™×¥ ×œ××™×¦×•×™ ×›×•×©×¨ ×”×©×ª×›×¨×•×ª</b>. ×©×›×¨ ×”××™× ×™××•×: ${formatV(minWage)}.`);
    }
    E('insightBox').innerHTML = insights.join('<br><br>');
}

function resetAll() { if(confirm("×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™×?")) location.reload(); }
function closeEntry() { E('entryPanel').style.display = 'none'; }

E('btnShot').onclick = () => {
    html2canvas(E('calcRoot'), { scale: 2, backgroundColor: '#1e293b' }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'ye-calculator-results.png';
        link.href = canvas.toDataURL();
        link.click();
    });
};

updateUI();
</script>

</body>
</html>

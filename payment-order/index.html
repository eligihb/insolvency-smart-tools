<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™×</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
.scale-container {
Â  transform: scale(0.82);
Â  transform-origin: top center;
Â  width: 122%;
}

:root{
Â  --primary:#005f73; --secondary:#0a9396; --bg:#f4f7f9; --panel:#fff;
Â  --text:#1f2937; --label:#4b5563; --border:#dbe3ea; --accent:#ee9b00;
Â  --danger:#ae2012; --blue:#0a58ff; --muted:#6b7280;
Â  --maxw:860px;
}

*{box-sizing:border-box}
body{
Â  font-family:'Heebo',sans-serif;
Â  background:var(--bg);
Â  color:var(--text);
Â  margin:0;
Â  padding:12px;
Â  display:flex;
Â  justify-content:center;
Â  min-height:100vh
}

.calculator{width:100%;max-width:var(--maxw)}
header{
Â  background:var(--primary);color:#fff;border-radius:14px;box-shadow:0 8px 22px rgba(0,0,0,.08);
Â  padding:10px 14px;display:flex;align-items:center;justify-content:center;position:relative
}
header h1{margin:0;font-size:1.28rem;line-height:1}
.year-badge{position:absolute;inset-inline-start:10px;inset-block-start:8px;font-size:.72rem;color:#e6f4f1;background:rgba(255,255,255,.12);padding:3px 8px;border:1px solid rgba(255,255,255,.25);border-radius:10px}

.board{
Â  margin-top:10px;background:#fbfeff;border:1px solid #e6eef5;border-radius:14px;
Â  box-shadow:0 6px 20px rgba(0,0,0,.06);
Â  padding:10px;
Â  display:grid;grid-template-columns:1fr 1fr;gap:10px;
}

/* ×ª×•×¦××•×ª ××©×××œ (×¢××•×“×” 2), ×”×–× ×” ××™××™×Ÿ (×¢××•×“×” 1) */
.results-col{background:#eaf6f6;border:1px solid var(--border);border-radius:12px;padding:10px;grid-column:2}
.inputs-col{background:#fff;border:1px solid var(--border);border-radius:12px;padding:10px;grid-column:1}

.section-title{margin:2px 0 8px;color:var(--primary);font-size:.98rem;font-weight:700;text-align:center}
.controls-top{display:flex;gap:8px;justify-content:center;margin:6px 0 10px;flex-wrap:nowrap}
.btn{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #cfd8e3;border-radius:10px;background:#fff;cursor:pointer;font-weight:500;font-size:.9rem}
.btn:hover{background:#f6f8fb}
.btn.reset{border-color:#a0aec0}

.result-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.result-card{background:#fff;border:1px solid #dbe9ea;border-radius:10px;padding:8px;text-align:center}
.result-card .k{color:var(--muted);font-weight:500;font-size:.9rem}
.result-card .v{margin-top:4px;font-weight:700;color:var(--accent);font-size:1rem}

/* ×¢×™×¦×•×‘ ××“ ×”××—×•×–×™× */
.ratio-visual {
  grid-column: 1/-1;
  background: #e2e8f0;
  height: 12px;
  border-radius: 6px;
  margin: 4px 0 8px;
  overflow: hidden;
  display: flex;
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
}
.ratio-bar-d { background: var(--secondary); transition: width 0.4s ease; width: 50%; border-inline-end: 1px solid #fff; }
.ratio-bar-p { background: var(--accent); transition: width 0.4s ease; width: 50%; }

.result-wide{grid-column:1/-1}
.result-big .v{font-size:1.08rem;color:var(--blue)}
.result-danger .v{color:var(--danger)}
.zero-case{color:#c2410c;font-weight:800;font-size:.98rem}

.center-card{max-width:340px;margin-inline:auto}
.solo-pay{grid-column:1/-1;max-width:340px;justify-self:center}

.row{display:grid;gap:8px}
.row-2{grid-template-columns:repeat(2,minmax(0,1fr))}
.row-3{grid-template-columns:repeat(3,minmax(0,1fr))}
.input-pair{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
.input-group{display:flex;flex-direction:column;align-items:stretch}
.input-group label{
Â  font-weight:600;color:var(--label);display:flex;gap:6px;align-items:center;justify-content:center;
Â  margin-bottom:3px;font-size:.9rem;text-align:center;min-height:40px;line-height:1.2
}
.input-group input,.input-group select,.input-group textarea{
Â  border:1px solid var(--border);padding:6px 8px;border-radius:10px;font-size:.95rem;background:#fbfeff
}
.input-group input:focus,.input-group select:focus,.input-group textarea:focus{outline:none;border-color:var(--secondary);box-shadow:0 0 0 3px rgba(10,147,150,.18)}
.input-group textarea{min-height:70px;resize:vertical}
.readonly{background:#f2f6ff;border-color:#cfe0ff;color:#1f3a8a;font-weight:600}

.status-row{max-width:60%;margin-inline:auto}

.toggles-line{display:flex;gap:8px;align-items:center;justify-content:center;flex-wrap:nowrap}
.chip{
Â  padding:5px 10px;border:1px solid #cfd8e3;border-radius:999px !important;
Â  background:#fff;cursor:pointer;font-size:.88rem;line-height:1;color:#0b2239;
}
.chip.active{background:#0d9488;color:#fff;border-color:#0d9488}
.chip.alert{background:#fff;border-color:#cfd8e3;color:#b42318}
.chip.alert.active{background:#b42318;color:#fff;border-color:#b42318}

.info-btn{width:18px;height:18px;border-radius:50%;background:#eef6f6;color:#0d6b6b;display:inline-flex;align-items:center;justify-content:center;font-size:.8rem;border:1px solid #d4e7e7;cursor:pointer}
.pop{position:absolute;z-index:1000;max-width:320px;background:#fff7d6;color:#3b2f00;border:1px solid #ffe6a8;border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.15);padding:10px 12px;line-height:1.45}

.report-trigger{display:flex;justify-content:center;margin:8px 0 4px}
.report-btn{background:#fff;border:1px dashed #c8d2de;padding:8px 12px;border-radius:12px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;font-size:.95rem;font-weight:600}
.report-btn:hover{background:#f6fbff}
#reportPanel{display:none}
.note-toggle{margin-inline-start:auto;display:inline-flex;align-items:center;gap:6px;cursor:pointer;color:#0d6b6b}

.sticky-mobile{display:none}

@media (max-width:768px){
Â  .calculator{max-width:100%}
Â  header h1{font-size:1.12rem}
Â  .year-badge{display:none}

Â  .board{grid-template-columns:1fr;gap:10px}
Â  .inputs-col{order:1}
Â  .results-col{order:2;padding-bottom:84px}

Â  .status-row{
Â  Â  max-width:100%;
Â  Â  margin:0 auto 6px auto;
Â  Â  justify-items:center;
Â  }
Â  .status-row .input-group{width:min(420px,100%)}
Â  .status-row .toggles-line{justify-content:center;flex-wrap:wrap}

Â  .row-2,.input-pair{grid-template-columns:repeat(2,minmax(0,1fr))}
Â  .row-3{grid-template-columns:repeat(2,minmax(0,1fr))}

Â  .sticky-mobile{
Â  Â  position:fixed;left:50%;transform:translateX(-50%);
Â  Â  width:min(100%, var(--maxw));
Â  Â  bottom:0;background:#ffffffcc;backdrop-filter:saturate(1.2) blur(6px);
Â  Â  border-top:1px solid #dfe7ee;padding:6px 8px;display:flex;gap:6px;justify-content:space-between;z-index:10
Â  }
Â  .btn{flex:1;justify-content:center;padding:9px 6px}
Â  .controls-top{display:none!important}
}

.shot-scale{transform:scale(.96);transform-origin:top center}
</style>
</head>
<body>
<div class="scale-container">
Â  <div class="calculator" id="calcRoot">
Â  Â  <header>
Â  Â  Â  <span class="year-badge" id="yearBadge"></span>
Â  Â  Â  <h1>××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™×</h1>
Â  Â  </header>

Â  Â  <div class="board">
Â  Â  Â  Â  Â  Â  <div class="inputs-col">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="row status-row">
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>×¡×˜×˜×•×¡ ××©×¤×—×ª×™</label>
Â  Â  Â  Â  Â  <div class="toggles-line" id="familyTypeGroup">
Â  <button class="chip family-type active" data-type="×™×—×™×“/ × ×©×•×™ ×—×™ ×‘× ×¤×¨×“">×™×—×™×“/ × ×©×•×™ ×—×™ ×‘× ×¤×¨×“</button>
Â  <button class="chip family-type" data-type="×¨×•×•×§/ ×’×¨×•×©/ ××œ××Ÿ">×¨×•×•×§/ ×’×¨×•×©/ ××œ××Ÿ</button>
Â  <button class="chip family-type" data-type="×–×•×’">×–×•×’</button>
</div>

Â  Â  Â  Â  Â  Â  <div class="toggles-line" style="margin-top:6px">
Â  Â  Â  Â  Â  Â  Â  <span>××¡×³ ×™×œ×“×™×:</span>
Â  Â  Â  Â  Â  Â  Â  <input id="childrenCount" type="number" min="0" max="10" value="0" style="width:60px;text-align:center;">
Â  Â  Â  Â  Â  Â  Â  <button class="chip" type="button" id="addChildBtn">×”×•×¡×£ ×™×œ×“</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="toggles-line">
Â  Â  Â  Â  Â  Â  <span>××™ ×‘×”×œ×™×š?</span>
Â  Â  Â  Â  Â  Â  <button class="chip" id="debtorMaleBtn" aria-pressed="true">×—×™×™×‘</button>
Â  Â  Â  Â  Â  Â  <button class="chip" id="debtorFemaleBtn" aria-pressed="false">×—×™×™×‘×ª</button>
Â  Â  Â  Â  Â  Â  <button class="chip alert" id="jointBtn" aria-pressed="false">×©× ×™ ×‘× ×™ ×”×–×•×’ ×‘×”×œ×™×š?</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <hr style="border:none;border-top:1px solid var(--border);margin:6px 0 8px">

Â  Â  Â  Â  <div class="section-title">×”×›× ×¡×•×ª ×•×”×•×¦××•×ª ×”×ª× ×”××©×¤×—×ª×™ (â‚ª)</div>

Â  Â  Â  Â  <div class="input-pair">
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label><span id="lblSalaryD">×”×›× ×¡×” (×—×™×™×‘/×ª)</span> <span class="info-btn" data-info="×××•×¦×¢ × ×˜×• ×ª×œ×•×©×™ ×©×›×¨">?</span></label>
Â  Â  Â  Â  Â  Â  <input id="salaryDebtor" type="number" placeholder="×”×–×Ÿ ×”×›× ×¡×”">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label><span id="lblSalaryP">×”×›× ×¡×” (×‘×Ÿ/×‘×ª ×–×•×’)</span> <span class="info-btn" data-info="×××•×¦×¢ × ×˜×• ×ª×œ×•×©×™ ×©×›×¨">?</span></label>
Â  Â  Â  Â  Â  Â  <input id="salaryPartner" type="number" placeholder="×”×–×Ÿ ×”×›× ×¡×”">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="input-pair">
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label><span id="lblOtherD">×”×›× ×¡×•×ª ××—×¨×•×ª (×—×™×™×‘/×ª)</span> <span class="info-btn" data-info="×œ×“×•×’××”: ×¤×¨×™×œ× ×¡/×©×›×™×¨×•×ª">?</span></label>
Â  Â  Â  Â  Â  Â  <input id="otherIncomeDebtor" type="number" placeholder="×”×–×Ÿ ×”×›× ×¡×” ××—×¨×ª">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label><span id="lblOtherP">×”×›× ×¡×•×ª ××—×¨×•×ª (×‘×Ÿ/×‘×ª ×–×•×’)</span> <span class="info-btn" data-info="×œ×“×•×’××”: ×¤×¨×™×œ× ×¡/×©×›×™×¨×•×ª">?</span></label>
Â  Â  Â  Â  Â  Â  <input id="otherIncomePartner" type="number" placeholder="×”×–×Ÿ ×”×›× ×¡×” ××—×¨×ª">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="row" style="justify-items:center">
Â  Â  Â  Â  Â  <div class="toggles-line" style="margin-top:4px">
Â  Â  Â  Â  Â  Â  <button class="chip" id="btnAllowances">×§×¦×‘××•×ª</button>
Â  Â  Â  Â  Â  Â  <button class="chip" id="btnAlimony">××–×•× ×•×ª</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="allowanceFields" class="row row-2" style="margin-top:6px;display:none">
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label><span id="lblAllowD">×§×¦×‘×” (×—×™×™×‘/×ª)</span> <span class="info-btn" data-info="×§×¦×‘××•×ª ×§×™×™××•×ª">?</span></label>
Â  Â  Â  Â  Â  Â  <input id="debtorAllowance" type="number" placeholder="×”×–×Ÿ ×§×¦×‘×”">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label><span id="lblAllowP">×§×¦×‘×” (×‘×Ÿ/×‘×ª ×–×•×’)</span> <span class="info-btn" data-info="×§×¦×‘××•×ª ×§×™×™××•×ª">?</span></label>
Â  Â  Â  Â  Â  Â  <input id="partnerAllowance" type="number" placeholder="×”×–×Ÿ ×§×¦×‘×”">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="alimonyFields" class="row row-2" style="margin-top:6px;display:none">
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>×”×•×¦××•×ª ××–×•× ×•×ª <span class="info-btn" data-info="××–×•× ×•×ª ×‘×ª×©×œ×•× ×—×•×“×©×™">?</span></label>
Â  Â  Â  Â  Â  Â  <input id="alimonyExpenses" type="number" placeholder="×”×–×Ÿ ×”×•×¦××•×ª ××–×•× ×•×ª">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="input-pair" style="margin-top:6px">
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>×”×•×¦××•×ª ×—×¨×™×’×•×ª <span class="info-btn" data-info="×¨×¤×•××™, × ×¡×™×¢×” ×•×›×“×³">?</span></label>
Â  Â  Â  Â  Â  Â  <input id="unusualExpenses" type="number" placeholder="×”×–×Ÿ ×”×•×¦××•×ª">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>×”×•×¦××•×ª ×˜×™×¤×•×œ ×•×¦×”×¨×•× ×™× <span class="info-btn" data-info="×¦×”×¨×•× ×™×/×˜×™×¤×•×œ">?</span></label>
Â  Â  Â  Â  Â  Â  <input id="childcareExpenses" type="number" placeholder="×”×–×Ÿ ×”×•×¦××•×ª">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="report-trigger">
Â  Â  Â  Â  Â  <button class="report-btn" id="reportBtn">ğŸ“Œ ×¤×¨×˜×™ ×“×•×´×—</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="reportPanel" class="row row-3" style="margin-top:4px">
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>××¡×³ ×ª×™×§</label>
Â  Â  Â  Â  Â  Â  <input id="caseId" type="text" placeholder="×œ×“×•×’××”: 12345/25">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>×©× ×¢×•×¨×š/×ª ×”×—×™×©×•×‘</label>
Â  Â  Â  Â  Â  Â  <input id="authorName" type="text" placeholder="×©× ××œ×">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label>×ª××¨×™×š</label>
Â  Â  Â  Â  Â  Â  <input id="reportDate" type="text" class="readonly" readonly>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="input-group" style="grid-column:1/-1;display:none" id="noteRow">
Â  Â  Â  Â  Â  Â  <label>×”×¢×¨×”</label>
Â  Â  Â  Â  Â  Â  <textarea id="reportNote" maxlength="500" placeholder="×”×¢×¨×” ×¢×“ 500 ×ª×•×•×™×"></textarea>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="note-toggle" id="noteToggle" style="grid-column:1/-1">ğŸ“Œ ×¤×ª×—/×™ ×©×“×” ×”×¢×¨×”</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="results-col">
Â  Â  Â  Â  <div class="controls-top">
Â  Â  Â  Â  Â  <button class="btn" id="btnPdf">ğŸ–¨ï¸ PDF</button>
Â  Â  Â  Â  Â  <button class="btn" id="btnShot">ğŸ“¸ ×¦×™×œ×•×</button>
Â  Â  Â  Â  Â  <button class="btn" id="btnMail">âœ‰ï¸ ×©×œ×™×—×ª ××™×™×œ</button>
Â  Â  Â  Â  Â  <button class="btn reset" id="btnReset">â†º ××™×¤×•×¡</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="section-title">×ª×•×¦××•×ª ×”×—×™×©×•×‘</div>

Â  Â  Â  Â  <div class="result-grid">
Â  Â  Â  Â  Â  <div class="result-card"><div class="k">×¡×š ×”×›× ×¡×•×ª</div><div class="v" id="totalIncomeResult">â‚ª 0</div></div>
Â  Â  Â  Â  Â  <div class="result-card"><div class="k">×§×¦×‘×ªÂ  ×™×œ×“×™×</div><div class="v" id="socialSecurityAllowance">â‚ª 0</div></div>

Â  Â  Â  Â  Â  <div class="result-card"><div class="k">×“××™ ××—×™×™×” ×‘×›×‘×•×“</div><div class="v" id="baseLivingCostResult">â‚ª 0</div></div>
Â  Â  Â  Â  Â  <div class="result-card"><div class="k">×¡×š ×”×•×¦××•×ª</div><div class="v" id="totalExpensesResult">â‚ª 0</div></div>

Â  Â  Â  Â  Â  <div class="result-card result-wide result-big">
Â  Â  Â  Â  Â  Â  <div class="k">×”×›× ×¡×” ×¤× ×•×™×” ×œ×ª× ×”××©×¤×—×ª×™</div>
Â  Â  Â  Â  Â  Â  <div class="v" id="disposableIncomeResult">××™×Ÿ ×”×›× ×¡×” ×¤× ×•×™×”</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="result-card"><div class="k" id="debtorIncomeRatioLabel">××—×•×– ×”×›× ×¡×” (×—×™×™×‘/×ª)</div><div class="v" id="debtorIncomeRatio">0.0%</div></div>
Â  Â  Â  Â  Â  <div class="result-card"><div class="k" id="partnerIncomeRatioLabel">××—×•×– ×”×›× ×¡×” (×‘×Ÿ/×‘×ª ×–×•×’)</div><div class="v" id="partnerIncomeRatio">0.0%</div></div>

          <div class="ratio-visual">
            <div id="barDebtor" class="ratio-bar-d"></div>
            <div id="barPartner" class="ratio-bar-p"></div>
          </div>

Â  Â  Â  Â  Â  <div class="result-card" id="debtorPaymentCard"><div class="k" id="debtorPaymentLabel">×ª×©×œ×•× ××•×¦×¢ (×—×™×™×‘/×ª)</div><div class="v" id="debtorPaymentResult">â‚ª 0</div></div>
Â  Â  Â  Â  Â  <div class="result-card" id="partnerPaymentCard" style="display:none"><div class="k" id="partnerPaymentLabel">×ª×©×œ×•× ××•×¦×¢ (×‘×Ÿ/×‘×ª ×–×•×’)</div><div class="v" id="partnerPaymentResult">â‚ª 0</div></div>

Â  Â  Â  Â  Â  <div class="result-card result-wide result-danger center-card" id="familyPaymentCard" style="display:none">
Â  Â  Â  Â  Â  Â  <div class="k">×ª×©×œ×•× ×—×•×“×©×™ ×œ×ª× ××©×¤×—×ª×™</div>
Â  Â  Â  Â  Â  Â  <div class="v" id="finalPaymentResult">â‚ª 0</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="result-card result-wide" id="zeroCaseRow" style="display:none">
Â  Â  Â  Â  Â  Â  <div class="v zero-case">×ª×™×§ ××¤×¡</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="sticky-mobile">
Â  Â  Â  Â  Â  <button class="btn" id="btnPdf_m">ğŸ–¨ï¸ PDF</button>
Â  Â  Â  Â  Â  <button class="btn" id="btnShot_m">ğŸ“¸ ×¦×™×œ×•×</button>
Â  Â  Â  Â  Â  <button class="btn" id="btnMail_m">âœ‰ï¸ ××™×™×œ</button>
Â  Â  Â  Â  Â  <button class="btn reset" id="btnReset_m">â†º ××™×¤×•×¡</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>

<script>
document.getElementById('yearBadge').textContent = `××¢×•×“×›×Ÿ ×œÖ¾${new Date().getFullYear()}`;

const fmt = n => new Intl.NumberFormat('he-IL',{style:'currency',currency:'ILS',minimumFractionDigits:0}).format(n||0);
const r10 = n => Math.floor((n||0)/10)*10;
const E = id => document.getElementById(id);

const els = {
Â  salaryD:E('salaryDebtor'), salaryP:E('salaryPartner'),
Â  otherD:E('otherIncomeDebtor'), otherP:E('otherIncomePartner'),
Â  allowD:E('debtorAllowance'), allowP:E('partnerAllowance'),
Â  unusual:E('unusualExpenses'), child:E('childcareExpenses'), alimony:E('alimonyExpenses'),

Â  tIncome:E('totalIncomeResult'), tExp:E('totalExpensesResult'),
Â  base:E('baseLivingCostResult'), kidsA:E('socialSecurityAllowance'),
Â  disp:E('disposableIncomeResult'),
Â  rDeb:E('debtorIncomeRatio'), rPar:E('partnerIncomeRatio'),
  barDeb:E('barDebtor'), barPar:E('barPartner'),
Â  payDeb:E('debtorPaymentResult'), payPar:E('partnerPaymentResult'),
Â  famCard:E('familyPaymentCard'), payFam:E('finalPaymentResult'),
Â  zeroRow:E('zeroCaseRow'),
Â  partnerCard:E('partnerPaymentCard'), debtorPayCard:E('debtorPaymentCard'),

Â  lblRD:E('debtorIncomeRatioLabel'), lblRP:E('partnerIncomeRatioLabel'),
Â  lblPD:E('debtorPaymentLabel'),Â  Â  lblPP:E('partnerPaymentLabel'),

Â  lblSalaryD:E('lblSalaryD'), lblSalaryP:E('lblSalaryP'),
Â  lblOtherD:E('lblOtherD'),Â  lblOtherP:E('lblOtherP'),
Â  lblAllowD:E('lblAllowD'),Â  lblAllowP:E('lblAllowP'),

Â  btnAllow:E('btnAllowances'), boxAllow:E('allowanceFields'),
Â  btnAlim:E('btnAlimony'),Â  Â  boxAlim:E('alimonyFields'),

Â  male:E('debtorMaleBtn'), female:E('debtorFemaleBtn'), joint:E('jointBtn'),

Â  reportBtn:E('reportBtn'), reportPanel:E('reportPanel'),
Â  reportDate:E('reportDate'), noteToggle:E('noteToggle'), noteRow:E('noteRow'),

Â  children:E('childrenCount'), addChild:E('addChildBtn'),
};

const livingBase = {
Â  "×™×—×™×“/ × ×©×•×™ ×—×™ ×‘× ×¤×¨×“":4556,
Â  "×¨×•×•×§/ ×’×¨×•×©/ ××œ××Ÿ":4556,
Â  "×–×•×’":6024,
};

const kidsMap = {0:0,1:169,2:383,3:597,4:811,5:980,6:1149,7:1318,8:1487,9:1656,10:1825};

let gender='×—×™×™×‘', joint=false;
let familyType = "×™×—×™×“/ × ×©×•×™ ×—×™ ×‘× ×¤×¨×“";
let childrenCount = 0;

function updateLabelSets(){
Â  const d=(gender==='×—×™×™×‘')?'×—×™×™×‘':'×—×™×™×‘×ª';
Â  const p=(gender==='×—×™×™×‘')?'×‘×ª ×–×•×’':'×‘×Ÿ ×–×•×’';
Â  els.lblRD.textContent=`××—×•×– ×”×›× ×¡×” (${d})`;
Â  els.lblRP.textContent=`××—×•×– ×”×›× ×¡×” (${p})`;
Â  els.lblPD.textContent=`×ª×©×œ×•× ××•×¦×¢ (${d})`;
Â  els.lblPP.textContent=`×ª×©×œ×•× ××•×¦×¢ (${p})`;
Â  els.lblSalaryD.textContent=`×”×›× ×¡×” (${d})`;
Â  els.lblSalaryP.textContent=`×”×›× ×¡×” (${p})`;
Â  els.lblOtherD.textContent =`×”×›× ×¡×•×ª ××—×¨×•×ª (${d})`;
Â  els.lblOtherP.textContent =`×”×›× ×¡×•×ª ××—×¨×•×ª (${p})`;
Â  els.lblAllowD.textContent =`×§×¦×‘×” (${d})`;
Â  els.lblAllowP.textContent =`×§×¦×‘×” (${p})`;
}
function setGender(g){
Â  gender=g;
Â  els.male.classList.toggle('active', g==='×—×™×™×‘');
Â  els.female.classList.toggle('active', g==='×—×™×™×‘×ª');
Â  els.male.setAttribute('aria-pressed', String(g==='×—×™×™×‘'));
Â  els.female.setAttribute('aria-pressed', String(g==='×—×™×™×‘×ª'));
Â  updateLabelSets(); calc();
}
els.male.onclick=()=>setGender('×—×™×™×‘');
els.female.onclick=()=>setGender('×—×™×™×‘×ª');

els.joint.onclick=()=>{
Â  joint=!joint;
Â  els.joint.classList.toggle('active', joint);
Â  els.joint.setAttribute('aria-pressed', String(joint));
Â  els.famCard.style.display= joint ? 'block' : 'none';
Â  els.partnerCard.style.display = joint ? 'block' : 'none';
Â  els.debtorPayCard.classList.toggle('solo-pay', !joint);
Â  calc();
};

els.btnAllow.onclick=()=>{ els.btnAllow.classList.toggle('active'); els.boxAllow.style.display=els.btnAllow.classList.contains('active')?'grid':'none'; };
els.btnAlim.onclick =()=>{ els.btnAlim .classList.toggle('active'); els.boxAlim .style.display=els.btnAlim .classList.contains('active')?'grid':'none'; };

els.reportBtn.onclick=()=>{
Â  const show = els.reportPanel.style.display!=='grid';
Â  els.reportPanel.style.display = show?'grid':'none';
Â  if(show){ els.reportDate.value = new Date().toLocaleDateString('he-IL',{year:'numeric',month:'2-digit',day:'2-digit'}); }
};
els.noteToggle.onclick=()=>{
Â  const on = els.noteRow.style.display!=='block';
Â  els.noteRow.style.display = on?'block':'none';
};

/* ×‘×—×™×¨×ª ×¡×˜×˜×•×¡ ××©×¤×—×ª×™ + ×™×œ×“×™× */
const familyTypeButtons = document.querySelectorAll('.family-type');
familyTypeButtons.forEach(btn=>{
Â  btn.addEventListener('click',()=>{
Â  Â  familyType = btn.dataset.type;
Â  Â  familyTypeButtons.forEach(b=>b.classList.toggle('active', b===btn));
Â  Â  calc();
Â  });
});

els.addChild.onclick = ()=>{
Â  let current = parseInt(els.children.value,10) || 0;
Â  if(current < 10){
Â  Â  current++;
Â  Â  els.children.value = String(current);
Â  Â  childrenCount = current;
Â  Â  calc();
Â  }
};

els.children.addEventListener('input',()=>{
Â  let val = parseInt(els.children.value,10);
Â  if(isNaN(val) || val < 0) val = 0;
Â  if(val > 10) val = 10;
Â  els.children.value = String(val);
Â  childrenCount = val;
Â  calc();
});

/* ×¤×•×¤××‘×¨ ? */
let pop=null;
document.addEventListener('click',e=>{
Â  const b=e.target.closest('.info-btn');
Â  if(b){
Â  Â  e.stopPropagation();
Â  Â  if(pop) pop.remove();
Â  Â  pop=document.createElement('div'); pop.className='pop'; pop.innerHTML=(b.dataset.info||'').replace(/\n/g,'<br>');
Â  Â  document.body.appendChild(pop);
Â  Â  const r=b.getBoundingClientRect(); pop.style.top=(window.scrollY+r.bottom+8)+'px'; pop.style.right=(window.innerWidth-r.right+8)+'px';
Â  Â  return;
Â  }
Â  if(pop){ pop.remove(); pop=null; }
});

/* ×—×™×©×•×‘ */
function calc(){
Â  const base0 = livingBase[familyType] || 4556;
Â  const base = base0 + (childrenCount * 1500);
Â  const kids = kidsMap[childrenCount] || 0;

Â  const dS=+els.salaryD.value||0, pS=+els.salaryP.value||0;
Â  const dO=+els.otherD.value||0,Â  pO=+els.otherP.value||0;
Â  const dA=+els.allowD.value||0,Â  pA=+els.allowP.value||0;
Â  const un=+els.unusual.value||0, ch=+els.child.value||0, al=+els.alimony.value||0;

Â  els.base.textContent = fmt(base);
Â  els.kidsA.textContent = fmt(kids);

Â  const totalIncome = dS+pS + dO+pO + dA+pA + kids;
Â  els.tIncome.textContent = fmt(totalIncome);

Â  const totalExp = base + un + ch + al;
Â  els.tExp.textContent = fmt(totalExp);

Â  const disp = totalIncome - totalExp;
Â  els.disp.textContent = disp<=0 ? '××™×Ÿ ×”×›× ×¡×” ×¤× ×•×™×”' : fmt(disp);

Â  const sumForRatio = dS+dO + pS+pO;
Â  const rD = sumForRatio>0 ? (dS+dO)/sumForRatio : 0;
Â  const rP = sumForRatio>0 ? (pS+pO)/sumForRatio : 0;
Â  els.rDeb.textContent = (rD*100).toFixed(1)+'%';
Â  els.rPar.textContent = (rP*100).toFixed(1)+'%';

  // ×¢×“×›×•×Ÿ ××“ ××—×•×–×™× ×•×™×–×•××œ×™
  els.barDeb.style.width = (rD * 100) + '%';
  els.barPar.style.width = (rP * 100) + '%';

Â  const payD = r10((disp*rD)/2);
Â  const payP = r10((disp*rP)/2);
Â  els.payDeb.textContent = fmt(Math.max(0,payD));
Â  els.payPar.textContent = fmt(Math.max(0,payP));

Â  if(joint){
Â  Â  const fam = r10( Math.max(0, (disp/2) - payP ) * rD + payP );
Â  Â  els.payFam.textContent = fmt(fam);
Â  }

Â  const zeroCase = (dS===0 && dO===0 && dA>0);
Â  els.zeroRow.style.display = zeroCase ? 'block':'none';
}

/* ×××–×™× ×™× */
[
Â  'salaryDebtor','salaryPartner','otherIncomeDebtor','otherIncomePartner',
Â  'debtorAllowance','partnerAllowance','unusualExpenses','childcareExpenses','alimonyExpenses'
].forEach(id=>E(id).addEventListener('input',calc));

/* ×¦×™×œ×•× */
function doShot(){
Â  const root=document.getElementById('calcRoot');
Â  root.classList.add('shot-scale');
Â  html2canvas(root,{useCORS:true,allowTaint:true,scale:2,backgroundColor:'#ffffff'})
Â  Â  .then(cv=>{
Â  Â  Â  root.classList.remove('shot-scale');
Â  Â  Â  const data=cv.toDataURL('image/png');
Â  Â  Â  const w=window.open('','_blank');
Â  Â  Â  w.document.write(`<img src="${data}" style="max-width:100%;display:block;margin:0 auto">`);
Â  Â  Â  w.document.title='×¦×™×œ×•× ××¡×š ×”××—×©×‘×•×Ÿ';
Â  Â  })
Â  Â  .catch(()=>{ root.classList.remove('shot-scale'); alert('×©×’×™××” ×‘×™×¦×™×¨×ª ×¦×™×œ×•× ×”××¡×š'); });
}

/* ×”×“×¤×¡×”/â€PDF ×›××™××’×³ ×‘×“×£ A4 */
function doPrint(){
Â  const root=document.getElementById('calcRoot');
Â  root.classList.add('shot-scale');
Â  html2canvas(root,{useCORS:true,allowTaint:true,scale:2,backgroundColor:'#ffffff'}).then(cv=>{
Â  Â  root.classList.remove('shot-scale');
Â  Â  const dataURL=cv.toDataURL('image/png');

Â  Â  const pageW=200, pageH=287;
Â  Â  const aspect=cv.width/cv.height;
Â  Â  let imgWmm=pageW, imgHmm=imgWmm/aspect;
Â  Â  if(imgHmm>pageH){ imgHmm=pageH; imgWmm=imgHmm*aspect; }

Â  Â  const html=`<!doctype html><html dir="rtl"><head><meta charset="utf-8">
Â  Â  Â  <style>@page{size:A4 portrait;margin:5mm}html,body{margin:0}img{display:block;margin:0 auto;width:${imgWmm}mm;height:${imgHmm}mm}</style>
Â  Â  Â  </head><body>
Â  Â  Â  <img id="shot" src="${dataURL}" alt="××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™×" onload="setTimeout(()=>{window.print();window.close()},100)">
Â  Â  Â  </body></html>`;
Â  Â  const w=window.open('','_blank'); w.document.write(html); w.document.close(); w.focus();
Â  }).catch(()=>{ root.classList.remove('shot-scale'); alert('××™×¨×¢×” ×©×’×™××” ×‘×–××Ÿ ×™×¦×™×¨×ª ×”-PDF/×”×“×¤×¡×”'); });
}
function getTxt(id){return (E(id)?.textContent||'').trim();}
function doMail(){
Â  const subject='×ª×•×¦××•×ª ××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™×';
Â  const body=[
Â  Â  '×©×œ×•×,','',
Â  Â  '×ª×§×¦×™×¨ ×”×ª×•×¦××•×ª (×œ×¦×¨×£ ×™×“× ×™×ª ××ª ×”-PNG/â€PDF):','',
Â  Â  `×¡×š ×”×›× ×¡×•×ª: ${getTxt('totalIncomeResult')}`,
Â  Â  `×¡×š ×”×•×¦××•×ª: ${getTxt('totalExpensesResult')}`,
Â  Â  `×”×›× ×¡×” ×¤× ×•×™×”: ${getTxt('disposableIncomeResult')}`,
Â  Â  `××—×•×– ×”×›× ×¡×” (×—×™×™×‘/×ª): ${getTxt('debtorIncomeRatio')}`,
Â  Â  `××—×•×– ×”×›× ×¡×” (×‘×Ÿ/×‘×ª ×–×•×’): ${getTxt('partnerIncomeRatio')}`,
Â  Â  `×ª×©×œ×•× ××•×¦×¢ (×—×™×™×‘/×ª): ${getTxt('debtorPaymentResult')}`,
Â  Â  (els.partnerCard.style.display!=='none')?`×ª×©×œ×•× ××•×¦×¢ (×‘×Ÿ/×‘×ª ×–×•×’): ${getTxt('partnerPaymentResult')}`:'',
Â  Â  (els.famCard.style.display!=='none')?`×ª×©×œ×•× ×—×•×“×©×™ ×œ×ª× ××©×¤×—×ª×™: ${getTxt('finalPaymentResult')}`:'',
Â  Â  '','×‘×‘×¨×›×”'
Â  ].filter(Boolean).join('\n');
Â  window.location.href=`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}
function doReset(){
Â  document.querySelectorAll('input[type="number"],input[type="text"],textarea').forEach(i=>{ if(i.id!=='childrenCount') i.value=''; });
Â  els.children.value='0';
Â  childrenCount=0;
Â  familyType="×™×—×™×“/ × ×©×•×™ ×—×™ ×‘× ×¤×¨×“";
Â  document.querySelectorAll('.family-type').forEach((btn,idx)=>btn.classList.toggle('active', idx===0));

Â  if(els.btnAllow.classList.contains('active')) els.btnAllow.click();
Â  if(els.btnAlim .classList.contains('active')) els.btnAlim .click();
Â  joint=false; els.joint.classList.remove('active'); els.joint.setAttribute('aria-pressed','false');
Â  els.famCard.style.display='none'; els.partnerCard.style.display='none';
Â  els.debtorPayCard.classList.add('solo-pay');
Â  setGender('×—×™×™×‘'); calc();
}

/* ×›×¤×ª×•×¨×™× */
E('btnPdf').onclick=doPrint; E('btnPdf_m')?.addEventListener('click',doPrint);
E('btnShot').onclick=doShot;Â  E('btnShot_m')?.addEventListener('click',doShot);
E('btnMail').onclick=doMail;Â  E('btnMail_m')?.addEventListener('click',doMail);
E('btnReset').onclick=doReset; E('btnReset_m')?.addEventListener('click',doReset);

/* init */
setGender('×—×™×™×‘');
els.debtorPayCard.classList.add('solo-pay');
calc();
</script>
</body>
</html>
